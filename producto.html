<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Producto | SpaceYisusShop</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header>
    <a href="index.html" class="logo">ü™ê SpaceYisusShop</a>
  </header>

  <main id="product-page" class="container">
    <section id="product-detail" class="product-detail">
      <!-- El contenido se cargar√° din√°micamente -->
    </section>
  </main>

  <footer>
    <p> 2025 SpaceYisusShop</p>
  </footer>

  <script>
// Funci√≥n para obtener producto desde API Netlify Function
async function getProductoById(id) {
    try {
        console.log('üîç Buscando producto:', id);
        const response = await fetch('/.netlify/functions/producto?id=' + id);
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => ({}));
            throw new Error(errorData.error || 'Producto no encontrado');
        }
        
        const product = await response.json();
        console.log('‚úÖ Producto encontrado:', product);
        return product;
    } catch (error) {
        console.error('‚ùå Error:', error);
        throw error;
    }
}

// Cuando la p√°gina carga
document.addEventListener('DOMContentLoaded', async function() {
    console.log('üìÑ P√°gina cargada');
    
    // Obtener ID de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const productId = urlParams.get('id');
    console.log('üÜî ID del producto:', productId);

    if (!productId) {
        mostrarError('No se encontr√≥ ID del producto en la URL');
        return;
    }

    // Mostrar loading
    document.getElementById('product-detail').innerHTML = `
        <div style="text-align: center; padding: 50px;">
            <div style="font-size: 2rem;">‚è≥</div>
            <p>Cargando producto...</p>
        </div>
    `;

    try {
        // Obtener producto
        const product = await getProductoById(productId);
        mostrarProducto(product);
        
    } catch (error) {
        console.error('üí• Error:', error);
        mostrarError('Error: ' + error.message);
    }
});

function mostrarProducto(product) {
    const productDetail = document.getElementById('product-detail');
    
    // Crear HTML del producto
    productDetail.innerHTML = `
        <div class="producto-detalle">
            <div class="producto-imagen">
                <img src="${product.imagen || 'https://via.placeholder.com/400x300?text=Imagen+No+Disponible'}" 
                     alt="${product.nombre}" 
                     style="max-width: 100%; border-radius: 10px;">
            </div>
            <div class="producto-info">
                <h1>${product.nombre || 'Producto'}</h1>
                <p class="descripcion">${product.descripcion || 'Sin descripci√≥n disponible'}</p>
                <p class="precio">$${(product.precio || 0).toLocaleString('es-CO')}</p>
                <p class="categoria"><strong>Categor√≠a:</strong> ${product.categoria || 'General'}</p>
                <p class="stock"><strong>Stock:</strong> ${product.stock || 0} unidades</p>
                <p class="envio"><strong>Env√≠o:</strong> ${product.envio || 'Consultar'}</p>
                <button class="btn-comprar" onclick="agregarAlCarrito('${product._id}')">
                    üõí Agregar al Carrito
                </button>
            </div>
        </div>
    `;
}

function mostrarError(mensaje) {
    document.getElementById('product-detail').innerHTML = `
        <div style="text-align: center; padding: 50px; color: red;">
            <h2>üòï Producto no encontrado</h2>
            <p>${mensaje}</p>
            <a href="/" style="color: blue; text-decoration: underline;">‚Üê Volver a la tienda</a>
        </div>
    `;
}

function agregarAlCarrito(productoId) {
    console.log('üõí Agregando al carrito:', productoId);
    alert('‚úÖ Producto agregado al carrito: ' + productoId);
}
</script>
</body>
</html>

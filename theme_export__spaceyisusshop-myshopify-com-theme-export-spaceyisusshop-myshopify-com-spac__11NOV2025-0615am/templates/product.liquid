{% assign current_variant = product.selected_or_first_available_variant %}

<section class="product-page">
  <div class="product-container">
    
    <!-- Imagen principal -->
    <div class="product-gallery">
      <img 
        id="main-product-image"
        src="{{ current_variant.featured_image | default: product.featured_image | img_url: '800x' }}" 
        alt="{{ product.title }}" 
        class="product-main-image"
      >
    </div>

    <!-- Info -->
    <div class="product-info">
      <h1 class="product-title">{{ product.title }}</h1>

      <!-- Precio dinámico -->
      <div class="product-price">
        <span id="dynamic-price">{{ current_variant.price | money }}</span>
        {% if current_variant.compare_at_price > current_variant.price %}
          <span id="dynamic-compare" class="compare-price">{{ current_variant.compare_at_price | money }}</span>
        {% else %}
          <span id="dynamic-compare" class="compare-price" style="display:none;"></span>
        {% endif %}
      </div>

      <!-- Formulario -->
      <form method="post" action="/cart/add" class="product-form">
        
        <!-- Variantes -->
        {% if product.variants.size > 1 %}
          <div class="product-variants">
            <label for="product-select">Escoge tu variante:</label>
            <select id="product-select" name="id">
              {% for variant in product.variants %}
                <option 
                  value="{{ variant.id }}" 
                  data-image="{{ variant.featured_image | img_url: '800x' }}"
                  data-price="{{ variant.price }}"
                  data-compare="{{ variant.compare_at_price }}"
                  {% if variant == current_variant %}selected{% endif %}
                >
                  {{ variant.title }} — {{ variant.price | money }}
                </option>
              {% endfor %}
            </select>
          </div>
        {% else %}
          <input type="hidden" name="id" value="{{ current_variant.id }}">
        {% endif %}

        <!-- Cantidad -->
        <div class="quantity-selector">
          <button type="button" class="qty-btn" onclick="this.nextElementSibling.stepDown()">-</button>
          <input type="number" name="quantity" min="1" value="1">
          <button type="button" class="qty-btn" onclick="this.previousElementSibling.stepUp()">+</button>
        </div>

        <!-- Botón agregar -->
        <button type="submit" class="add-to-cart">
          Agregar al Carrito — 
          <span id="btn-price">{{ current_variant.price | money }}</span>
          {% if current_variant.compare_at_price > current_variant.price %}
            <span id="btn-compare" class="compare-price">{{ current_variant.compare_at_price | money }}</span>
          {% else %}
            <span id="btn-compare" class="compare-price" style="display:none;"></span>
          {% endif %}
        </button>
      </form>
    </div>
  </div>
</section>

<!-- Script variante dinámica -->
<script>
  document.addEventListener("DOMContentLoaded", function() {
    const select = document.getElementById("product-select");
    const price = document.getElementById("dynamic-price");
    const btnPrice = document.getElementById("btn-price");
    const compare = document.getElementById("dynamic-compare");
    const btnCompare = document.getElementById("btn-compare");
    const mainImage = document.getElementById("main-product-image");

    if (select) {
      select.addEventListener("change", function() {
        const option = this.options[this.selectedIndex];
        const newPrice = option.dataset.price;
        const comparePrice = option.dataset.compare;
        const image = option.dataset.image;

        // Actualizar precios principales
        price.textContent = Shopify.formatMoney(newPrice, "{{ shop.money_format }}");
        btnPrice.textContent = Shopify.formatMoney(newPrice, "{{ shop.money_format }}");

        // Mostrar/ocultar compare_at_price
        if (comparePrice && parseInt(comparePrice) > parseInt(newPrice)) {
          compare.style.display = "inline";
          compare.textContent = Shopify.formatMoney(comparePrice, "{{ shop.money_format }}");

          btnCompare.style.display = "inline";
          btnCompare.textContent = Shopify.formatMoney(comparePrice, "{{ shop.money_format }}");
        } else {
          compare.style.display = "none";
          btnCompare.style.display = "none";
        }

        // Actualizar imagen
        if (image) {
          mainImage.src = image;
        }
      });
    }
  });
</script>

<!-- Estilos -->
<style>
.product-page {
  padding: 2rem;
  display: flex;
  justify-content: center;
}
.product-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
  max-width: 1200px;
  width: 100%;
}
.product-main-image {
  width: 100%;
  border-radius: 1rem;
}
.product-title {
  font-size: 1.8rem;
  font-weight: 700;
  color: #fff;
  margin-bottom: .5rem;
}
.product-price {
  font-size: 1.5rem;
  font-weight: 600;
  color: var(--color-primary, #00d4ff);
  margin-bottom: 1rem;
}
.compare-price {
  font-size: 1rem;
  text-decoration: line-through;
  margin-left: .5rem;
  color: #aaa;
}
.product-variants select {
  width: 100%;
  padding: .6rem;
  border-radius: .5rem;
  background: #111;
  color: #fff;
  border: 1px solid #333;
  margin-bottom: 1rem;
}
.quantity-selector {
  display: flex;
  align-items: center;
  margin-bottom: 1rem;
}
.quantity-selector input {
  width: 50px;
  text-align: center;
  background: #111;
  color: #fff;
  border: 1px solid #333;
  font-weight: bold;
}
.qty-btn {
  background: var(--color-secondary, #ff6a00);
  color: #fff;
  border: none;
  padding: .5rem .8rem;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 700;
}
.qty-btn:hover {
  background: var(--color-primary, #00d4ff);
}
.add-to-cart {
  display: inline-block;
  width: 100%;
  padding: 1rem;
  background: var(--color-secondary, #ff6a00);
  color: #fff;
  font-size: 1.1rem;
  font-weight: bold;
  border: none;
  border-radius: .8rem;
  cursor: pointer;
  transition: all .3s;
}
.add-to-cart:hover {
  background: var(--color-primary, #00d4ff);
}
</style>
